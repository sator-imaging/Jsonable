on:
  workflow_dispatch:

env:
  # net6.0 for Unity compatibility tests
  target: net6.0

jobs:

  benchmark:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout
      uses: actions/checkout@v4
      with:
        fetch-depth: 0

    - name: Install .NET
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: |
          10.x.x
          5.x.x

    - name: Install libssl1.1 (for .NET 5)
      run: |
        sudo apt-get update
        sudo apt-get install -y libssl1.1 || sudo apt-get install -y libssl-dev

    - name: Embed resources
      run: |
        dotnet run --project ./embedded  -f net8.0 -- --force --quiet

    - name: Run benchmark
      run: |
        dotnet run --project ./sample  -c Release -f ${{ env.target }} -- --benchmark --short-run
